<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ŒíœÖŒ∂Œ±ŒΩœÑŒπŒΩŒ¨ ŒöœÅœÖœÄœÑœåŒªŒµŒæŒ±</title>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #eef2f5;
            --box-bg: #2c3e50;
            --text-color: #333;
            --success: #27ae60;
            /* Responsive sizes */
            --input-size: 38px; 
            --input-font: 1.1rem;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Header & Logo --- */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: var(--box-bg);
            font-size: 1.8rem;
            margin: 0;
            line-height: 1.2;
            font-weight: 700;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .title-logo {
            height: 55px;
            width: auto;
            margin-right: 15px;
            vertical-align: middle;
            mix-blend-mode: multiply;
        }
        
        .title-logo[src=""] { display: none; }

        /* --- Main Layout --- */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 1200px; 
        }

        /* --- Quote Section (The Puzzle) --- */
        #quote-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px 15px;
            margin-bottom: 35px;
            width: 100%;
            background: white;
            padding: 25px 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        .word-group {
            display: flex;
            flex-wrap: wrap; /* Allow long Greek words to wrap if screen is tiny */
            justify-content: center;
            gap: 2px;
            margin-bottom: 5px;
        }

        /* --- Clues Section (The Helper Words) --- */
        #clues-area {
            display: grid;
            /* Responsive Grid: Cards resize to fit screen */
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
            width: 100%;
            margin-bottom: 40px;
        }

        /* CARD STYLE: Vertical Stack to ensure text visibility */
        .clue-row {
            display: flex;
            flex-direction: column; /* Stack vertically: Text top, inputs bottom */
            align-items: center;
            text-align: center;
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #e1e4e8;
        }

        .clue-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px; /* Space between text and boxes */
        }

        .clue-icon { font-size: 1.4rem; }
        
        .clue-text { 
            font-weight: 600; 
            font-size: 0.95rem; 
            color: #2c3e50; 
            line-height: 1.3;
            /* Ensure text wraps naturally */
            white-space: normal; 
            word-wrap: break-word;
        }
        
        .clue-inputs { 
            display: flex; 
            gap: 3px; 
            justify-content: center;
            flex-wrap: wrap; /* Allow letters to wrap if clue word is very long */
        }

        /* --- Input Box Styling --- */
        .letter-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        input.letter-box {
            width: var(--input-size); 
            height: calc(var(--input-size) * 1.15);
            text-align: center; 
            font-size: var(--input-font); 
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #cbd5e0; 
            border-radius: 6px;
            background-color: #f8fafc; 
            color: var(--box-bg);
            padding: 0;
            margin: 0;
            -webkit-appearance: none;
            touch-action: manipulation;
            transition: all 0.2s;
        }
        
        .punctuation-box {
             width: var(--input-size); 
             height: calc(var(--input-size) * 1.15);
             display: flex; 
             justify-content: center; 
             align-items: flex-end;
             font-size: 1.4rem; 
             font-weight: bold; 
             color: var(--box-bg);
             padding-bottom: 5px;
        }

        input.letter-box:focus {
            outline: none; 
            border-color: var(--primary);
            background-color: white; 
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
            transform: translateY(-2px);
            z-index: 10;
        }

        input.letter-box.highlight { background-color: #dbeafe; border-color: #93c5fd; }
        input.letter-box.correct { background-color: var(--primary); color: white; border-color: var(--primary); }

        .letter-number {
            font-size: 0.7rem; 
            font-weight: bold; 
            color: #7f8c8d; 
            margin-top: 3px;
        }

        /* --- Footer --- */
        footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--box-bg);
            background: white;
            width: 100%;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            border-radius: 15px 15px 0 0;
        }

        /* --- Modals --- */
        #win-modal {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); background: white;
            padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center; z-index: 100;
            width: 90%;
            max-width: 450px;
        }
        
        #win-modal h2 { margin: 0 0 15px 0; color: var(--success); font-size: 1.8rem; }
        #win-modal p { margin-bottom: 25px; color: #555; font-size: 1.1rem; line-height: 1.4; }
        
        #next-btn {
            background: var(--primary); color: white; border: none;
            padding: 15px 30px; border-radius: 30px;
            cursor: pointer; font-size: 1.1rem; font-weight: bold;
            transition: background 0.2s, transform 0.1s;
            width: 100%;
        }
        #next-btn:hover { background: #357abd; transform: scale(1.02); }

        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 99;
            backdrop-filter: blur(2px);
        }

        /* --- Mobile Specific Tweaks --- */
        @media (max-width: 600px) {
            :root {
                --input-size: 30px; /* Slightly smaller for Greek words which can be long */
                --input-font: 1rem;
            }
            
            body { padding: 10px; }
            h1 { font-size: 1.4rem; }
            .title-logo { height: 45px; margin-right: 10px; }
            
            #quote-area { padding: 15px 5px; gap: 8px 4px; }
            
            /* On mobile, use 2 columns if screen fits, or 1 if very small */
            #clues-area { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }
            
            .clue-row { padding: 10px 5px; }
            .clue-text { font-size: 0.85rem; }
            .clue-icon { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <div class="header-container">
        <h1>
            <img src="logo.png" alt="Logo" class="title-logo" onerror="this.style.display='none'">
            ŒíœÖŒ∂Œ±ŒΩœÑŒπŒΩŒ¨ ŒöœÅœÖœÄœÑœåŒªŒµŒæŒ±
        </h1>
    </div>

    <main>
        <div id="quote-area"></div>
        <div id="clues-area"></div>
    </main>

    <footer>
        ‚ú®‚úçÔ∏è Œ†Œ±ŒΩŒ±Œ≥ŒπœéœÑŒ∑œÇ ŒîœåŒºŒ≤œÅŒøœÇ, ŒïŒ∫œÄŒ±ŒπŒ¥ŒµœÖœÑŒπŒ∫œåœÇ ŒëŒ≥Œ≥ŒªŒπŒ∫œéŒΩ Œ∫Œ±Œπ ŒòŒµŒ±œÑœÅŒøŒªœåŒ≥ŒøœÇ ‚úçÔ∏è‚ú®
    </footer>

    <div id="overlay"></div>
    <div id="win-modal">
        <h2>üéâ Œ£œÖŒ≥œáŒ±œÅŒ∑œÑŒÆœÅŒπŒ±!</h2>
        <p>Œó ŒªœçœÉŒ∑ ŒÆœÑŒ±ŒΩ:<br><strong id="final-msg"></strong></p>
        <button id="next-btn">ŒïœÄœåŒºŒµŒΩŒøœÇ ŒìœÅŒØœÜŒøœÇ ‚ñ∂</button>
    </div>

    <script>
        // ==========================================
        // 1. Œ§Œë ŒîŒïŒîŒüŒúŒïŒùŒë (THE DATA)
        // ==========================================
        
        // Œ§œÅŒ¨œÄŒµŒ∂Œ± ŒíœÖŒ∂Œ±ŒΩœÑŒπŒΩœéŒΩ Œ¶œÅŒ¨œÉŒµœâŒΩ & ŒüŒΩŒøŒºŒ¨œÑœâŒΩ
        const quoteBank = [
            "ŒùŒôŒ®ŒüŒù ŒëŒùŒüŒúŒóŒúŒëŒ§Œë ŒúŒó ŒúŒüŒùŒëŒù ŒüŒ®ŒôŒù", 
            "ŒïŒëŒõŒ© Œó Œ†ŒüŒõŒôŒ£", 
            "ŒíŒëŒ£ŒôŒõŒïŒ•Œ£ ŒíŒëŒ£ŒôŒõŒïŒ©Œù ŒíŒëŒ£ŒôŒõŒïŒ•Œ©Œù ŒíŒëŒ£ŒôŒõŒïŒ•ŒüŒ•Œ£Œô", 
            "Œ§Œó Œ•Œ†ŒïŒ°ŒúŒëŒßŒ© Œ£Œ§Œ°ŒëŒ§ŒóŒìŒ© Œ§Œë ŒùŒôŒöŒóŒ§ŒóŒ°ŒôŒë", 
            "ŒïŒù Œ§ŒüŒ•Œ§Œ© ŒùŒôŒöŒë", 
            "ŒëŒìŒôŒë Œ£ŒüŒ¶ŒôŒë Œó Œ§ŒüŒ• ŒòŒïŒüŒ• Œ£ŒüŒ¶ŒôŒë", 
            "ŒôŒüŒ•Œ£Œ§ŒôŒùŒôŒëŒùŒüŒ£ Œü ŒúŒïŒìŒëŒ£", 
            "ŒöŒ©ŒùŒ£Œ§ŒëŒùŒ§ŒôŒùŒüŒ£ Œü Œ†ŒëŒõŒëŒôŒüŒõŒüŒìŒüŒ£", 
            "ŒíŒëŒ£ŒôŒõŒïŒôŒüŒ£ Œü ŒíŒüŒ•ŒõŒìŒëŒ°ŒüŒöŒ§ŒüŒùŒüŒ£", 
            "ŒëŒùŒùŒë ŒöŒüŒúŒùŒóŒùŒó Œó ŒëŒõŒïŒûŒôŒëŒîŒë", 
            "Œ§Œü ŒíŒ•ŒñŒëŒùŒ§ŒôŒüŒù ŒïŒ£Œ§ŒôŒù Œó ŒëŒ°ŒßŒó Œ§ŒüŒ• ŒöŒüŒ£ŒúŒüŒ•", 
            "Œü Œ†ŒüŒ°Œ¶Œ•Œ°ŒüŒìŒïŒùŒùŒóŒ§ŒüŒ£", 
            "Œó Œ°Œ©ŒúŒëŒùŒôŒë Œ†ŒëŒ°ŒòŒïŒù", 
            "Œ£Œ©Œ†ŒëŒ£Œï ŒöŒ•Œ°Œë ŒîŒïŒ£Œ†ŒüŒôŒùŒë ŒöŒëŒô ŒúŒó Œ†ŒüŒõŒ•ŒîŒëŒöŒ°Œ•ŒñŒïŒôŒ£", 
            "ŒöŒ•Œ°ŒôŒï ŒïŒõŒïŒóŒ£ŒüŒù", 
            "Œó Œ†ŒüŒõŒôŒ£ Œ§Œ©Œù Œ†ŒüŒõŒïŒ©Œù", 
            "ŒòŒïŒüŒîŒ©Œ°Œë Œó ŒëŒ•Œ§ŒüŒöŒ°ŒëŒ§ŒïŒôŒ°Œë", 
            "ŒüŒô ŒúŒ†ŒõŒï ŒöŒëŒô ŒüŒô Œ†Œ°ŒëŒ£ŒôŒùŒüŒô", 
            "Œ•ŒìŒ°ŒüŒù Œ†Œ•Œ°", 
            "Œü ŒîŒôŒöŒïŒ¶ŒëŒõŒüŒ£ ŒëŒïŒ§ŒüŒ£" 
        ];

        // ŒõŒµŒæŒπŒ∫œå ŒõŒ≠ŒæŒµœâŒΩ Œ≥ŒπŒ± Œ≤ŒøŒÆŒ∏ŒµŒπŒ± (Greek Dictionary for Clues)
        const clueDictionary = [
            { w: "ŒëŒìŒôŒüŒ£", h: "ŒôŒµœÅœå œÄœÅœåœÉœâœÄŒø", i: "üôè" }, { w: "Œ†ŒüŒõŒó", h: "ŒúŒµŒ≥Œ¨ŒªŒøœÇ ŒøŒπŒ∫ŒπœÉŒºœåœÇ", i: "üèôÔ∏è" },
            { w: "ŒùŒüŒúŒüŒ£", h: "ŒöŒ±ŒΩœåŒΩŒ±œÇ Œ¥ŒπŒ∫Œ±ŒØŒøœÖ", i: "‚öñÔ∏è" }, { w: "ŒßŒ°Œ•Œ£ŒüŒ£", h: "Œ†ŒøŒªœçœÑŒπŒºŒø ŒºŒ≠œÑŒ±ŒªŒªŒø", i: "ü•á" },
            { w: "ŒùŒëŒüŒ£", h: "ŒïŒ∫Œ∫ŒªŒ∑œÉŒØŒ±", i: "‚õ™" }, { w: "Œ¶Œ©Œ£", h: "ŒõŒ¨ŒºœàŒ∑", i: "üí°" },
            { w: "Œ•ŒîŒ©Œ°", h: "ŒùŒµœÅœå (Œ±œÅœáŒ±ŒØŒ±)", i: "üíß" }, { w: "ŒîŒüŒûŒë", h: "Œ§ŒπŒºŒÆ Œ∫Œ±Œπ œÜŒÆŒºŒ∑", i: "üåü" },
            { w: "Œ£Œ§Œ°ŒëŒ§ŒüŒ£", h: "ŒïŒΩœéœÄŒªŒµœÇ Œ¥œÖŒΩŒ¨ŒºŒµŒπœÇ", i: "‚öîÔ∏è" }, { w: "ŒëŒ°Œ§ŒüŒ£", h: "Œ®œâŒºŒØ", i: "ü•ñ" },
            { w: "ŒüŒôŒùŒüŒ£", h: "ŒöœÅŒ±œÉŒØ", i: "üç∑" }, { w: "ŒíŒôŒüŒ£", h: "ŒñœâŒÆ", i: "üå±" },
            { w: "ŒìŒó", h: "Œ†ŒªŒ±ŒΩŒÆœÑŒ∑œÇ ŒÆ Œ≠Œ¥Œ±œÜŒøœÇ", i: "üåç" }, { w: "ŒòŒëŒõŒëŒ£Œ£Œë", h: "ŒúŒµŒ≥Œ¨ŒªŒø ŒΩŒµœÅœå", i: "üåä" },
            { w: "Œ†ŒõŒüŒôŒü", h: "ŒöŒ±œÅŒ¨Œ≤Œπ", i: "‚õµ" }, { w: "ŒôŒ†Œ†ŒüŒ£", h: "ŒÜŒªŒøŒ≥Œø", i: "üêé" },
            { w: "ŒûŒôŒ¶ŒüŒ£", h: "Œ£œÄŒ±Œ∏ŒØ", i: "üó°Ô∏è" }, { w: "ŒëŒ£Œ†ŒôŒîŒë", h: "ŒëŒºœÖŒΩœÑŒπŒ∫œå œåœÄŒªŒø", i: "üõ°Ô∏è" },
            { w: "ŒíŒôŒíŒõŒôŒü", h: "ŒëŒΩŒ¨Œ≥ŒΩœâœÉŒºŒ±", i: "üìñ" }, { w: "ŒìŒ°ŒëŒ¶Œó", h: "ŒöŒµŒØŒºŒµŒΩŒø", i: "‚úçÔ∏è" },
            { w: "ŒïŒôŒöŒüŒùŒë", h: "ŒòœÅŒ∑œÉŒ∫ŒµœÖœÑŒπŒ∫ŒÆ Œ∂œâŒ≥œÅŒ±œÜŒπŒ¨", i: "üñºÔ∏è" }, { w: "Œ®Œ•ŒßŒó", h: "Œ†ŒΩŒµœçŒºŒ±", i: "üëª" },
            { w: "Œ£Œ©ŒúŒë", h: "Œ¶œÖœÉŒπŒ∫ŒÆ œÖœÄœåœÉœÑŒ±œÉŒ∑", i: "üßç" }, { w: "ŒóŒõŒôŒüŒ£", h: "ŒÜœÉœÑœÅŒø œÑŒ∑œÇ Œ∑ŒºŒ≠œÅŒ±œÇ", i: "‚òÄÔ∏è" },
            { w: "ŒùŒ•ŒßŒ§Œë", h: "Œ£Œ∫ŒøœÑŒ¨Œ¥Œπ", i: "üåô" }, { w: "ŒëŒïŒ§ŒüŒ£", h: "Œ†ŒµœÅŒÆœÜŒ±ŒΩŒø œÄŒøœÖŒªŒØ", i: "ü¶Ö" },
            { w: "ŒõŒïŒ©Œù", h: "ŒõŒπŒøŒΩœÑŒ¨œÅŒπ", i: "ü¶Å" }, { w: "Œ°ŒüŒîŒü", h: "Œ§œÅŒπŒ±ŒΩœÑŒ¨œÜœÖŒªŒªŒø", i: "üåπ" },
            { w: "Œ¶ŒôŒõŒüŒ£", h: "ŒëŒ≥Œ±œÄŒ∑œÑœåœÇ", i: "ü§ù" }, { w: "ŒïŒßŒòŒ°ŒüŒ£", h: "ŒëŒΩœÑŒØœÄŒ±ŒªŒøœÇ", i: "üò†" },
            { w: "Œ§ŒïŒôŒßŒüŒ£", h: "Œ†œÅŒøœÉœÑŒ±œÑŒµœÖœÑŒπŒ∫œåœÇ œÑŒøŒØœáŒøœÇ", i: "üß±" }, { w: "Œ†Œ•ŒõŒó", h: "ŒúŒµŒ≥Œ¨ŒªŒ∑ œÄœåœÅœÑŒ±", i: "üö™" },
            { w: "ŒßŒ°ŒüŒùŒüŒ£", h: "ŒèœÅŒ± Œ∫Œ±Œπ Œ∫Œ±ŒπœÅœåœÇ", i: "‚è≥" }, { w: "ŒëŒìŒìŒïŒõŒüŒ£", h: "ŒüœÖœÅŒ¨ŒΩŒπŒø œÄŒªŒ¨œÉŒºŒ±", i: "üëº" },
            { w: "Œ£Œ§ŒïŒúŒúŒë", h: "Œ¶ŒøœÅŒ¨ŒµŒπ Œø ŒíŒ±œÉŒπŒªŒπŒ¨œÇ", i: "üëë" }, { w: "ŒòŒ°ŒüŒùŒüŒ£", h: "ŒöŒ¨Œ∏ŒπœÉŒºŒ± ŒíŒ±œÉŒπŒªŒπŒ¨", i: "üí∫" },
            { w: "ŒîŒ°ŒüŒúŒüŒ£", h: "ŒüŒ¥œåœÇ", i: "üõ£Ô∏è" }, { w: "ŒüŒôŒöŒüŒ£", h: "Œ£œÄŒØœÑŒπ", i: "üè†" },
            { w: "ŒöŒóŒ†ŒüŒ£", h: "Œ†œÅŒ¨œÉŒπŒΩŒ∑ Œ±œÖŒªŒÆ", i: "üå≥" }, { w: "ŒúŒóŒõŒü", h: "Œ¶œÅŒøœçœÑŒø", i: "üçé" },
            { w: "Œ†ŒïŒ§Œ°Œë", h: "ŒõŒØŒ∏ŒøœÇ", i: "ü™®" }, { w: "ŒßŒëŒ°Œ§ŒóŒ£", h: "ŒîŒµŒØœáŒΩŒµŒπ œÑœåœÄŒøœÖœÇ", i: "üó∫Ô∏è" }
        ];

        // ==========================================
        // 2. LOGIC (ŒúŒóŒßŒëŒùŒôŒ£ŒúŒüŒ£)
        // ==========================================

        let currentQuote = "";
        let activeMapping = {};
        let availableQuotes = [];

        // Helper: Remove Greek Accents (ŒÜ -> Œë)
        function cleanGreek(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, "").toUpperCase();
        }

        // Generate Random Mapping for Greek Alphabet
        function generateMapping(quoteText) {
            const map = {};
            const usedNumbers = new Set();
            const cleanText = cleanGreek(quoteText);
            const uniqueChars = [...new Set(cleanText.split(''))].filter(c => c.match(/[Œë-Œ©]/));

            uniqueChars.forEach(char => {
                let num;
                do {
                    num = Math.floor(Math.random() * 30) + 1;
                } while (usedNumbers.has(num));
                
                usedNumbers.add(num);
                map[char] = num;
            });
            return map;
        }

        // SMART CLUE GENERATOR (GREEK VERSION)
        function generateSmartClues(quoteText) {
            let neededChars = new Set([...cleanGreek(quoteText).split('')].filter(c => c.match(/[Œë-Œ©]/)));
            let selectedClues = [];
            let safetyCounter = 0;

            while (neededChars.size > 0 && safetyCounter < 100) {
                let bestWordObj = null;
                let maxNewCoverage = 0;
                
                const shuffledDict = clueDictionary.sort(() => 0.5 - Math.random());

                for (let item of shuffledDict) {
                    if (selectedClues.includes(item)) continue;

                    let coverCount = 0;
                    const cleanWord = cleanGreek(item.w);
                    
                    for (let char of cleanWord) {
                        if (neededChars.has(char)) coverCount++;
                    }

                    if (coverCount > maxNewCoverage) {
                        maxNewCoverage = coverCount;
                        bestWordObj = item;
                    }
                }

                if (bestWordObj) {
                    selectedClues.push(bestWordObj);
                    const cleanWord = cleanGreek(bestWordObj.w);
                    for (let char of cleanWord) neededChars.delete(char);
                } else {
                    break;
                }
                safetyCounter++;
            }
            return selectedClues;
        }

        function extendMappingForClues(map, clueList) {
            const usedNumbers = new Set(Object.values(map));
            clueList.forEach(clue => {
                const cleanWord = cleanGreek(clue.w);
                for (let char of cleanWord) {
                    if (!map[char]) {
                        let num;
                        do {
                            num = Math.floor(Math.random() * 30) + 1;
                        } while (usedNumbers.has(num));
                        usedNumbers.add(num);
                        map[char] = num;
                    }
                }
            });
            return map;
        }

        // ==========================================
        // 3. UI RENDERING
        // ==========================================

        const quoteArea = document.getElementById('quote-area');
        const cluesArea = document.getElementById('clues-area');
        const overlay = document.getElementById('overlay');
        const winModal = document.getElementById('win-modal');
        const finalMsg = document.getElementById('final-msg');

        function createLetterBox(rawChar, isClueSection = false) {
            const container = document.createElement('div');
            container.className = 'letter-container';
            const char = cleanGreek(rawChar);

            if (activeMapping[char]) {
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.className = 'letter-box';
                
                // Mobile Optimization Attributes
                input.setAttribute('autocomplete', 'off');
                input.setAttribute('autocorrect', 'off');
                input.setAttribute('autocapitalize', 'off');
                input.setAttribute('spellcheck', 'false');
                input.setAttribute('inputmode', 'text');
                
                const num = activeMapping[char];
                const numberLabel = document.createElement('span');
                numberLabel.className = 'letter-number';
                numberLabel.innerText = num;

                input.dataset.number = num;
                input.dataset.answer = char;
                
                input.addEventListener('input', (e) => handleInput(e, num));
                input.addEventListener('focus', () => highlightGroup(num, true));
                input.addEventListener('blur', () => highlightGroup(num, false));
                input.addEventListener('keyup', (e) => {
                     // Check if input is a Greek char or Latin char
                     if(e.key.length === 1 && (e.key.match(/[Œ±-œâŒë-Œ©]/) || e.key.match(/[a-zA-Z]/))) {
                         let next = container.nextElementSibling; 
                         if(next && next.querySelector('input')) {
                             next.querySelector('input').focus();
                         }
                     }
                });

                container.appendChild(input);
                container.appendChild(numberLabel);
            } else if (!char.match(/[Œë-Œ©]/) && char !== ' ') {
                if(!isClueSection) {
                    const punct = document.createElement('div');
                    punct.className = 'punctuation-box';
                    punct.innerText = rawChar;
                    return punct;
                }
            } else if (char === ' ') {
                return null; 
            }
            return container;
        }

        function loadRandomPuzzle() {
            quoteArea.innerHTML = '';
            cluesArea.innerHTML = '';
            overlay.style.display = 'none';
            winModal.style.display = 'none';

            if (availableQuotes.length === 0) {
                availableQuotes = [...quoteBank];
            }
            const randIndex = Math.floor(Math.random() * availableQuotes.length);
            currentQuote = availableQuotes[randIndex];
            availableQuotes.splice(randIndex, 1);

            const generatedClues = generateSmartClues(currentQuote);
            activeMapping = generateMapping(currentQuote);
            activeMapping = extendMappingForClues(activeMapping, generatedClues);

            const words = currentQuote.split(' ');
            words.forEach(word => {
                const wordGroup = document.createElement('div');
                wordGroup.className = 'word-group';
                for (let char of word) {
                    const box = createLetterBox(char);
                    if(box) wordGroup.appendChild(box);
                }
                quoteArea.appendChild(wordGroup);
            });

            generatedClues.forEach(clue => {
                const row = document.createElement('div');
                row.className = 'clue-row';
                
                // Vertical Card Structure
                const infoDiv = document.createElement('div');
                infoDiv.className = 'clue-info';
                infoDiv.innerHTML = `<div class="clue-icon">${clue.i}</div><div class="clue-text">${clue.h}</div>`;

                const inputsDiv = document.createElement('div');
                inputsDiv.className = 'clue-inputs';
                const cleanWord = cleanGreek(clue.w);
                for (let char of cleanWord) {
                    const box = createLetterBox(char, true);
                    if(box) inputsDiv.appendChild(box);
                }

                row.appendChild(infoDiv);
                row.appendChild(inputsDiv);
                cluesArea.appendChild(row);
            });
        }

        function handleInput(e, numberId) {
            const val = cleanGreek(e.target.value);
            if (e.target.value !== val && val !== "") {
                e.target.value = val;
            }
            document.querySelectorAll(`input[data-number="${numberId}"]`).forEach(inp => {
                inp.value = val;
            });
            checkWin();
        }

        function highlightGroup(numberId, isActive) {
            document.querySelectorAll(`input[data-number="${numberId}"]`).forEach(inp => {
                inp.classList.toggle('highlight', isActive);
            });
        }

        function checkWin() {
            const quoteInputs = quoteArea.querySelectorAll('input.letter-box');
            let isFull = true; 
            let isCorrect = true;

            quoteInputs.forEach(input => {
                if (!input.value) isFull = false;
                if (cleanGreek(input.value) !== input.dataset.answer) isCorrect = false;
            });

            if (isFull && isCorrect) {
                document.querySelectorAll('input.letter-box').forEach(i => i.classList.add('correct'));
                
                if (document.activeElement) document.activeElement.blur();
                
                finalMsg.innerText = currentQuote;
                setTimeout(() => {
                    overlay.style.display = 'block';
                    winModal.style.display = 'block';
                }, 500);
            }
        }

        document.getElementById('next-btn').addEventListener('click', loadRandomPuzzle);

        loadRandomPuzzle();

    </script>
</body>
</html>